{% extends 'base.html' %}

{% block title %}Register - Attendify{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/register-form.css') }}">
{% endblock %}

{% block content %}
<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert"
    style="margin: 20px;">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

<!-- Role Selection Screen -->
<div class="role-selection-container">
    <div class="text-center mb-5">
        <img src="{{ url_for('static', filename='img/logos/attendify.svg') }}" alt="Attendify" style="height: 60px;">
        <h2 class="mt-3">Join Attendify</h2>
        <p class="text-muted">Select your role to get started</p>
    </div>

    <div class="row g-4 justify-content-center">
        <!-- College Admin Role Card -->
        <div class="col-md-6 col-lg-4">
            <div class="role-card" onclick="openRegisterModal('ADMIN')">
                <div class="role-icon">
                    <i class="bi bi-building"></i>
                </div>
                <h4>College Admin</h4>
                <p>Manage college operations and oversee departments</p>
            </div>
        </div>

        <!-- HOD Role Card -->
        <div class="col-md-6 col-lg-4">
            <div class="role-card" onclick="openRegisterModal('HOD')">
                <div class="role-icon">
                    <i class="bi bi-person-badge"></i>
                </div>
                <h4>HOD</h4>
                <p>Head of Department - Manage department activities</p>
            </div>
        </div>

        <!-- Faculty Role Card -->
        <div class="col-md-6 col-lg-4">
            <div class="role-card" onclick="openRegisterModal('FACULTY')">
                <div class="role-icon">
                    <i class="bi bi-person-workspace"></i>
                </div>
                <h4>Faculty</h4>
                <p>Take attendance and manage classes</p>
            </div>
        </div>

        <!-- Student Role Card -->
        <div class="col-md-6 col-lg-4">
            <div class="role-card" onclick="openRegisterModal('STUDENT')">
                <div class="role-icon">
                    <i class="bi bi-mortarboard"></i>
                </div>
                <h4>Student</h4>
                <p>View attendance and academic progress</p>
            </div>
        </div>

        <!-- Parent Role Card -->
        <div class="col-md-6 col-lg-4">
            <div class="role-card" onclick="openRegisterModal('PARENT')">
                <div class="role-icon">
                    <i class="bi bi-people"></i>
                </div>
                <h4>Parent</h4>
                <p>Monitor your child's attendance and performance</p>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <p>Already have an account? <a href="/login" class="fw-bold">Sign In</a></p>
    </div>
</div>

<!-- Registration Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-modal="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">
                    <i class="bi bi-person-plus"></i> Register as <span id="roleTitle"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Registration form -->
                <form id="registerForm" novalidate>
                    <!-- Hidden role field -->
                    <input type="hidden" id="role_id" name="role_id" required>

                    <!-- Full Name -->
                    <div class="form-group mb-3">
                        <label for="name" class="form-label">
                            <i class="bi bi-person"></i> Full Name *
                        </label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Your full name"
                            required />
                    </div>

                    <!-- Email -->
                    <div class="form-group mb-3">
                        <label for="email" class="form-label">
                            <i class="bi bi-envelope"></i> Email Address *
                        </label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com"
                            required />
                    </div>

                    <!-- Mobile (Optional) -->
                    <div class="form-group mb-3">
                        <label for="mobile" class="form-label">
                            <i class="bi bi-telephone"></i> Mobile Number
                        </label>
                        <input type="tel" class="form-control" id="mobile" name="mobile"
                            placeholder="10-digit mobile number" />
                    </div>

                    <!-- College Selection -->
                    <div class="form-group mb-3">
                        <label for="college_id" class="form-label">
                            <i class="bi bi-building"></i> College *
                        </label>
                        <select class="form-control" id="college_id" name="college_id" required>
                            <option value="">-- Select Your College --</option>
                            {% for college in colleges %}
                            <option value="{{ college.college_id }}">
                                {{ college.college_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Role-specific fields will be added here dynamically -->
                    <div id="roleSpecificFields"></div>

                    <!-- Password -->
                    <div class="form-group mb-3">
                        <label for="password" class="form-label">
                            <i class="bi bi-lock"></i> Password *
                        </label>
                        <input type="password" class="form-control" id="password" name="password"
                            placeholder="Create a strong password" required />
                        <small class="text-muted">Minimum 6 characters</small>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group mb-3">
                        <label for="confirm_password" class="form-label">
                            <i class="bi bi-lock-check"></i> Confirm Password *
                        </label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password"
                            placeholder="Re-enter your password" required />
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                        <label for="terms" class="form-check-label">
                            I agree to the <a href="/about" target="_blank">Terms & Conditions</a>
                        </label>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-person-check"></i> Create Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Include session manager and register JS -->
<script src="{{ url_for('static', filename='js/session-manager.js') }}"></script>
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}