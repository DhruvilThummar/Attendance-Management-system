{% extends 'faculty/fbase.html' %}

{% block title %}Attendance Analytics{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/college-dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/faculty.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="main-content">
        <div class="container p-4">
            <!-- Header Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="page-title">Attendance Analytics</h1>
                    <p class="text-muted">Visualizing attendance performance across your classes</p>
                </div>
            </div>

            <!-- Overview Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-indigo">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Avg. Attendance</h5>
                            <h3>82%</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-rose">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Best Class</h5>
                            <h3>ECE-A (92%)</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-azure">
                            <i class="fas fa-calendar-minus"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Lowest Day</h5>
                            <h3>Saturday (75%)</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row (Side by Side) -->
            <div class="row mb-4">
                <!-- Class-wise Analytics -->
                <div class="col-lg-6 mb-4">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <h5 class="card-title fw-bold mb-4">Class-wise Attendance Overview</h5>
                            <div class="chart-container">
                                <canvas id="classChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Day-wise Analytics -->
                <div class="col-lg-6 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 fw-bold">Day-wise Attendance (Weekly Trend)</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="dayChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Stats Table -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold">Attendance Breakdown</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">Division</th>
                                    <th>Subject</th>
                                    <th>Total Lectures</th>
                                    <th>Avg. Presence</th>
                                    <th class="pe-4 text-end">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="ps-4 fw-bold">CSE-A</td>
                                    <td>Web Technologies</td>
                                    <td>24</td>
                                    <td>
                                        <div class="progress rounded-pill progress-h-xs">
                                            <div class="progress-bar bg-primary" role="progressbar" style="width: 88%"
                                                aria-valuenow="88" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div> <small class="text-muted">85%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-success">Healthy</span></td>
                                </tr>
                                <tr>
                                    <td class="ps-4 fw-bold">CSE-B</td>
                                    <td>Database Management</td>
                                    <td>22</td>
                                    <td>
                                        <div class="progress progress-modern attendance-progress-sm">
                                            <div class="progress-bar bg-warning" style="width: 78%;"></div>
                                        </div>
                                        <small class="text-muted">78%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-warning text-dark">Watch</span></td>
                                </tr>
                                <tr>
                                    <td class="ps-4 fw-bold">ECE-A</td>
                                    <td>Data Structures</td>
                                    <td>18</td>
                                    <td>
                                        <div class="progress progress-modern attendance-progress-sm">
                                            <div class="progress-bar bg-info" style="width: 92%;"></div>
                                        </div>
                                        <small class="text-muted">92%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-info">Excellent</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Prepare data from Jinja2
    const classLabels = JSON.parse('{{ class_stats|map(attribute="division")|list|tojson|safe }}');
    const classData = JSON.parse('{{ class_stats|map(attribute="percentage")|list|tojson|safe }}');
    const dayLabels = JSON.parse('{{ day_stats|map(attribute="day")|list|tojson|safe }}');
    const dayData = JSON.parse('{{ day_stats|map(attribute="percentage")|list|tojson|safe }}');

    // Class-wise Chart
    const classCtx = document.getElementById('classChart').getContext('2d');
    new Chart(classCtx, {
        type: 'bar',
        data: {
            labels: classLabels,
            datasets: [{
                label: 'Attendance Percentage',
                data: classData,
                backgroundColor: 'rgba(102, 126, 234, 0.6)',
                borderColor: 'rgba(102, 126, 234, 1)',
                borderWidth: 1,
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });

    // Day-wise Chart
    const dayCtx = document.getElementById('dayChart').getContext('2d');
    new Chart(dayCtx, {
        type: 'line',
        data: {
            labels: dayLabels,
            datasets: [{
                label: 'Attendance Trend',
                data: dayData,
                fill: true,
                backgroundColor: 'rgba(237, 137, 54, 0.1)',
                borderColor: 'rgba(237, 137, 54, 1)',
                tension: 0.4,
                pointRadius: 4,
                pointBackgroundColor: 'rgba(237, 137, 54, 1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });
</script>
{% endblock %}