{% extends 'faculty/fbase.html' %}

{% block title %}Attendance Analytics{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/college-dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/faculty.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="main-content">
        <div class="container p-4">
            <!-- Header Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="page-title">Attendance Analytics</h1>
                    <p class="text-muted">Visualizing attendance performance across your classes</p>
                </div>
            </div>

            <!-- Overview Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-indigo">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Avg. Attendance</h5>
                            <h3>{{ avg_attendance }}%</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-rose">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Best Class</h5>
                            <h3>
                                {% if best_class %}
                                {{ best_class.division }} ({{ best_class.percentage }}%)
                                {% else %}
                                --
                                {% endif %}
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-gradient-azure">
                            <i class="fas fa-calendar-minus"></i>
                        </div>
                        <div class="stat-content">
                            <h5>Lowest Day</h5>
                            <h3>
                                {% if lowest_day %}
                                {{ lowest_day.day }} ({{ lowest_day.percentage }}%)
                                {% else %}
                                --
                                {% endif %}
                            </h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row (Side by Side) -->
            <div class="row mb-4">
                <!-- Weekly Attendance Chart -->
                <div class="col-lg-6 mb-4">
                    {% if charts.weekly_attendance %}
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 fw-bold">Weekly Attendance Report</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="chart-container">
                                <img class="img-fluid" src="{{ charts.weekly_attendance }}"
                                    alt="Weekly attendance chart" />
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Monthly Trend Chart -->
                <div class="col-lg-6 mb-4">
                    {% if charts.monthly_trend %}
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 fw-bold">Monthly Attendance Trend</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="chart-container">
                                <img class="img-fluid" src="{{ charts.monthly_trend }}" alt="Monthly trend chart" />
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Subject Attendance Chart -->
            <div class="row mb-4">
                <div class="col-12">
                    {% if charts.subject_attendance %}
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0 fw-bold">Subject-wise Attendance Overview</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="chart-container">
                                <img class="img-fluid" src="{{ charts.subject_attendance }}"
                                    alt="Subject attendance chart" />
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Detailed Stats Table -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold">Attendance Breakdown</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">Division</th>
                                    <th>Subject</th>
                                    <th>Total Lectures</th>
                                    <th>Avg. Presence</th>
                                    <th class="pe-4 text-end">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="ps-4 fw-bold">CSE-A</td>
                                    <td>Web Technologies</td>
                                    <td>24</td>
                                    <td>
                                        <div class="progress rounded-pill progress-h-xs">
                                            <div class="progress-bar bg-primary" role="progressbar" style="width: 88%"
                                                aria-valuenow="88" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div> <small class="text-muted">85%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-success">Healthy</span></td>
                                </tr>
                                <tr>
                                    <td class="ps-4 fw-bold">CSE-B</td>
                                    <td>Database Management</td>
                                    <td>22</td>
                                    <td>
                                        <div class="progress progress-modern attendance-progress-sm">
                                            <div class="progress-bar bg-warning" style="width: 78%;"></div>
                                        </div>
                                        <small class="text-muted">78%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-warning text-dark">Watch</span></td>
                                </tr>
                                <tr>
                                    <td class="ps-4 fw-bold">ECE-A</td>
                                    <td>Data Structures</td>
                                    <td>18</td>
                                    <td>
                                        <div class="progress progress-modern attendance-progress-sm">
                                            <div class="progress-bar bg-info" style="width: 92%;"></div>
                                        </div>
                                        <small class="text-muted">92%</small>
                                    </td>
                                    <td class="pe-4 text-end"><span class="badge bg-info">Excellent</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}